# 计算机图形学基础 2021

## 课程评价

* 上课最好还是听听，老师讲得不错，也能学到不少东西。
* 几乎每节课都有雨课堂测试题，**占总评分数**，但其实只要答了大概80%并且答对一半这样（几乎一半的题都是课件前面有答案的）就能拿满分了，但丢个几分其实也没多大关系（身边有丢两分照样拿A的同学）
* 代码的话小作业尽量自己写吧，照着课件上的公式自己写一遍能有不少收获，我在每个PA的文件夹里也放上了自己在写小作业时遇到的所有问题（在readme.md）里。
* 大作业的话难度比较大，虽然说看往届代码的话好像学长们都写了几千行这样，但实际上，如果在前面大作业框架基础上修改，自己写的代码是很少很少的。大概从网上借鉴了200行，自己写的代码也就200行不到（按照下述实现方法，虽然我又写了些东西，但也没啥用处，上面那个身边同学比我写得少了一点也是A）
* 虽然这个课卷A+（估计也不会有人这么做吧）很难很难，但是拿个A或者A-其实还挺轻松的，以下有实现步骤：

## 自己的大作业实现方法

（参考了诸多仓库里学长的方法）

* 为了尽量减少代码量，我是在PA1+PA3的基础上开始写的。
* 温馨提示：尽量不要裸抄，掌握思想的基础上自己写才是最好的
* 如果想写cuda的话这种实现方法不适用，因为Cuda更偏好不OOP的数据结构，需要对整体数据结构进行推倒重来。这个方法可以拿个不错的分数（大概吧）并且代码量小

### smallpt(25pts,150rows(modify))

* 首先**复制粘贴**一次99行版的smallpt（记住：欲速则不达，不要想着一开始就把smallpt改得符合自己的框架，否则就会导致乱七八糟的问题，直接复制粘贴然后慢慢改反而是最快的）
* 由于smallpt中光源的定义与框架中不同，我的做法是舍弃掉light类，使用sphere类加ambientColor作光源。
* 接着在**smallpt能跑**的基础上开始修改移植，首先把vector改成Vector3f，再改求交（用Ray和Hit类替换掉原来的实现，这样就可以沿用原来的求交函数，可能对于into变量要做做处理），每改一处就重新跑一次渲染，确保修改正确（ps：建议先把vecmath里全文搜索float替换成double），这样改完之后大概长成`pt.cpp`里面的样子
* ps: 建议理解一下smallpt的思想（网上也有相关讲义之类）
* 这个时候有两条路可选：写ppm或者写mesh，现在我更推荐先写ppm，因为ppm收敛极快，经常是渲染大概20分钟就能出一张效果不错的图，但pt可能同样效果要渲染几个小时

### smallppm(5pts,250rows(modify))

* ppm的话github也有板子可以参考（比如smallppm之类）
* 因为ppm里面追踪的逻辑和pt差不多，可以把改好的pt代码直接copy过来替换掉板子里的，并逐一修改数据结构。
* ps: ppm的思想也可以理解一下，但这个相对pt而言要难一些

### mesh(5pts,100rows)

* 包围盒和K-D Tree需要自己写，我在`aabb.cpp`和`kdtree.cpp`里提供了一种比较OO的实现，可供参考，但这不是唯一的实现方法，建议自己写写，这里大概需要自己写100行代码（实际上kdtree在数据结构课中也写过了）。

按道理来讲现在已经A-了，但是只要小作业或者课堂扣点分就危险，所以建议再写点东西。

### revsurface(5pts,40rows)

* 参数曲面会使渲染变得很卡，这里的加速仍有很大的研究空间
* 注意：PA3没有写参数曲面的手动求解，而是借助OpenGL求解。
* 牛顿迭代法解方程，正常的牛顿迭代很容易爆掉，我采用的方法是除个系数，让它慢点下降，虽然很笨但还蛮好用（需要调参）。
* 这里大概需要自己写40行代码，要解的方程在习题课里有（那个单变量的）。见`revsurface.cpp`，我是进行了一个特判，所以是两个几乎一样的函数，不特判的话可以把参数曲面别放在轴线上就可以了。

按道理来讲现在应该是稳A-了，如果想拿A的话再稍微写点东西。

### depth,texture...(2pts+,150rows)

* 景深看网上的可能麻烦一些，实际上就是改`camera.hpp`（这个可能确实参考起来要实现得快一些），注意：只有在焦距位置的物体才清晰，并且实现景深时最好在pt中实现（ppm的话详见报告，需要取个平均啥的）
* 纹理的话详见报告，实现起来也不是很难
* 抗锯齿的话做了也没啥大用（其实smallpt自带抗锯齿）

大概我就做了这些东西（最后得了A），虽然也做了个参数曲线的指令集加速，但那个做了其实也没啥大用。上面应该是最小代价拿不错分数的方法了。

## 一些其他

* 场景设计的话，我也没啥美感，就只设计了一张包含所有要素的图而已，调场景的技巧是：从三视图方向把物体放对位置。
* obj文件下载：free3d，最好移植一下tinyobjloader，这样会省好多事。（不过也是后面做的事情了）
* 建议早点写完，可以在软工结束之后直接开工（如果没有软工的话大概是14周左右开工），争取是在助教检查之前就写完，这样可以收到老师“你稳了”的邮件（doge）
* 人智导申请的华为优惠券居然派上用场了（我租了个按需付费的32C服务器跑图），这个故事告诉我们~~能白嫖，就白嫖~~

